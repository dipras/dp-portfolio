import"./script-BpwsN8_y.js";const u="https://be.dipras.my.id",l=document.querySelector("#comment-section"),i=document.querySelector("#comment-form"),m=document.querySelector("#comment-btn"),d=(r,o="success",s=4e3)=>{try{const n=document.querySelector(".dp-notification");n&&n.remove();const e=document.createElement("div");e.className=`dp-notification mb-4 p-3 rounded text-sm w-full max-w-md mx-auto text-center ${o==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.textContent=r,i.parentNode.insertBefore(e,i),setTimeout(()=>{e.remove()},s)}catch(n){console.warn("Notification error",n),alert(r)}},p=()=>{i.querySelectorAll(".dp-field-error").forEach(o=>o.remove())},y=(r=[])=>{try{p();const o=r.reduce((n,e)=>{const a=(e.path||e.property||"").replace(/^\//,"");return a&&(n[a]=n[a]||[],n[a].push(e.message||e.summary||"Invalid value")),n},{});let s=null;Object.keys(o).forEach(n=>{const e=i.querySelector(`[name="${n}"]`),t=o[n].join(" • "),c=document.createElement("div");c.className="dp-field-error text-red-600 text-sm mt-1",c.setAttribute("aria-live","polite"),c.textContent=t,e&&e.parentNode?(e.parentNode.insertBefore(c,e.nextSibling),s||(s=e)):d(t,"error")}),s&&typeof s.focus=="function"&&s.focus()}catch(o){console.warn("showFieldErrors error",o)}},f=r=>`
    <div class="border border-gray-200 p-4 rounded-lg">
        <div class="flex justify-between items-center mb-2">
            <h4 class="font-medium text-gray-900">${r.name}</h4>
            <span class="text-xs text-gray-400">${r.created_at}</span>
        </div>
        <p class="text-gray-600 text-sm leading-relaxed">${r.comment}</p>
    </div>
    `;(async()=>{try{const r=await fetch(`${u}/comment`).then(s=>s.json());if(r.data.length<1){l.innerHTML='<h1 class="text-center text-gray-500">There are no comment yet</h1>';return}let o=r.data.map(s=>f(s)).join("");l.innerHTML=o}catch{l.innerHTML='<h1 class="text-center text-red-400">There are some error happened, please contact me to tell me</h1>'}})();i.addEventListener("submit",async r=>{r.preventDefault();const o=new FormData(r.target),s=o.get("name")||"Anonymous",n=o.get("comment"),e=m.textContent;try{p(),m.disabled=!0,m.textContent="Sending...";const a=await fetch(`${u}/comment`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:s,comment:n})}),t=await a.json().catch(()=>null);if(a.status===422){t&&Array.isArray(t.errors)&&y(t.errors);const c=t&&(t.summary||t.message)?t.summary||t.message:"Terdapat kesalahan pada input.";d(c,"error");return}if(!a.ok||!t||!t.data)throw new Error(t&&t.message?t.message:"Server returned unexpected response");l.insertAdjacentHTML("afterbegin",f(t.data)),i.reset(),d("Terima kasih — pesan Anda berhasil dikirim.","success")}catch(a){console.error(a),d("Gagal mengirim pesan. Silakan coba lagi.","error")}finally{m.disabled=!1,m.textContent=e}});
