import"./script-DuZj9KI8.js";const u="https://be.dipras.my.id",d=document.querySelector("#comment-section"),m=document.querySelector("#comment-form"),i=document.querySelector("#comment-btn"),l=(e,t="success",s=4e3)=>{try{const n=document.querySelector(".dp-notification");n&&n.remove();const r=document.createElement("div");r.className=`dp-notification mb-4 p-3 rounded text-sm w-full max-w-md mx-auto text-center ${t==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,r.setAttribute("role","status"),r.setAttribute("aria-live","polite"),r.textContent=e,m.parentNode.insertBefore(r,m),setTimeout(()=>{r.remove()},s)}catch(n){console.warn("Notification error",n),alert(e)}},p=()=>{m.querySelectorAll(".dp-field-error").forEach(t=>t.remove())},g=(e=[])=>{try{p();const t=e.reduce((n,r)=>{const a=(r.path||r.property||"").replace(/^\//,"");return a&&(n[a]=n[a]||[],n[a].push(r.message||r.summary||"Invalid value")),n},{});let s=null;Object.keys(t).forEach(n=>{const r=m.querySelector(`[name="${n}"]`),o=t[n].join(" â€¢ "),c=document.createElement("div");c.className="dp-field-error text-red-600 text-sm mt-1",c.setAttribute("aria-live","polite"),c.textContent=o,r&&r.parentNode?(r.parentNode.insertBefore(c,r.nextSibling),s||(s=r)):l(o,"error")}),s&&typeof s.focus=="function"&&s.focus()}catch(t){console.warn("showFieldErrors error",t)}};function y(e){const t=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return`${t}:${s}:${n}`}const f=e=>{const t=new Date(e.created_at);return`
    <div class="border border-gray-200 p-4 rounded-lg">
        <div class="flex justify-between items-center mb-2">
            <h4 class="font-medium text-gray-900">${e.name}</h4>
            <span class="text-xs text-gray-400">${t.getDate()}-${t.getMonth()}-${t.getFullYear()}  ${y(t)}</span>
        </div>
        <p class="text-gray-600 text-sm leading-relaxed">${e.comment}</p>
    </div>
    `};(async()=>{try{const e=await fetch(`${u}/comment`).then(s=>s.json());if(e.data.length<1){d.innerHTML='<h1 class="text-center text-gray-500">There are no comment yet</h1>';return}let t=e.data.map(s=>f(s)).join("");d.innerHTML=t}catch{d.innerHTML='<h1 class="text-center text-red-400">There are some error happened, please contact me to tell me</h1>'}})();m.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(e.target),s=t.get("name")||"Anonymous",n=t.get("comment"),r=i.textContent;try{p(),i.disabled=!0,i.textContent="Sending...";const a=await fetch(`${u}/comment`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:s,comment:n})}),o=await a.json().catch(()=>null);if(a.status===422){o&&Array.isArray(o.errors)&&g(o.errors);const c=o&&(o.summary||o.message)?o.summary||o.message:"Terdapat kesalahan pada input.";l(c,"error");return}if(!a.ok||!o||!o.data)throw new Error(o&&o.message?o.message:"Server returned unexpected response");d.insertAdjacentHTML("afterbegin",f(o.data)),m.reset(),l("Thank you for your comment","success")}catch(a){console.error(a),l("Error sending your comment, please check the console for more information","error")}finally{i.disabled=!1,i.textContent=r}});
